<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductMapper">

	<resultMap type="cn.cebest.entity.system.product.Product" id="baseResultProduct">
		<id property="id" column="Id" />
		<result property="product_TemplateId" column="PRODUCT_TEMPLATEID" />
		<result property="product_TemplateName" column="TEM_NAME" />
		<result property="typeId" column="TYPEID" />
		<result property="product_WbUrl" column="PRODUCT_WBURL" />
		<result property="product_Summary" column="PRODUCT_SUMMARY" />
		<result property="product_KeyWords" column="PRODUCT_KEYWORDS" />
		<result property="product_Status" column="PRODUCT_STATUS" />
		<result property="name" column="NAME" />
		<result property="no" column="NO" />
		<result property="title" column="TITLE" />
		<result property="brandId" column="BRANDID" />
		<result property="flag" column="FLAG" />
		<result property="brandName" column="BRANDNAME" />
		<result property="recommend" column="RECOMMEND" />
		<result property="hot" column="HOT" />
		<result property="hot_time" column="HOT_TIME"/>
		<result property="top" column="TOP" />
		<result property="top_time" column="TOP_TIME"/>
		<result property="filedJson" column="FILEDJSON" />
		<result property="imgeId" column="IMAGEID" />
		<result property="release_Time" column="RELEASE_TIME" />
		<result property="imgUrl" column="IMGURL" />
		<result property="productTxt" column="TXT" />
		<result property="valueText" column="VALUETEXT" />
		<result property="brandName" column="B_NAME" />
		<result property="update_Time" column="UPDATE_TIME" />
		<result property="created_Time" column="CREATED_TIME" />
		<result property="area" column="AREA" />
		<result property="columId" column="COLUMNID" />
		<result property="sort" column="SORT"/>
		<result property="contentUrlName" column="contentUrlName" />
		<result property="columUrlName" column="columUrlName" />
		<collection property="productTypeList"
			ofType="cn.cebest.entity.system.product.Product_Type">
			<id property="id" column="TID_" />
			<result property="type_name" column="TYPE_NAME_" />
			<collection property="columConfigList" ofType="cn.cebest.entity.system.ColumConfig">
				<id property="id" column="COLUMNID_" />
				<result property="columName" column="COLUMNAME_" />
			</collection>
		</collection>
		<collection property="imageList" ofType="cn.cebest.entity.system.Image">
			<id column="image_id_" property="imageId" />
			<result column="type_" property="type" />
			<result column="title_" property="title" />
			<result column="imgurl_" property="imgurl" />
			<result column="bz" property="bz" />
			<result column="tourl_" property="tourl" />
			<result column="forder_" property="forder" />
		</collection>
		<collection property="videoList" ofType="cn.cebest.entity.system.Video">
			<id column="video_id_" property="id" />
			<result column="video_type_" property="video_type" />
			<result column="video_title_" property="video_title" />
			<result column="video_url_" property="video_url" />
			<result column="video_content_" property="video_content" />
			<result column="VIDEO_TOURL" property="tourl" />
		</collection>
		<collection property="columConfigList" ofType="cn.cebest.entity.system.ColumConfig">
			<id property="id" column="COLUMNID_" />
			<result property="columName" column="COLUMNAME_" />
		</collection>
		<collection property="seoInfo" ofType="cn.cebest.entity.system.Seo">
			<id property="id" column="SID" />
			<result property="seoTitle" column="STITLE" />
		</collection>
	</resultMap>

	<resultMap type="cn.cebest.entity.system.product.Product" id="resultProduct">
		<id property="id" column="id" />
		<result property="product_TemplateId" column="PRODUCT_TEMPLATEID" />
		<result property="product_WbUrl" column="PRODUCT_WBURL" />
		<result property="product_Summary" column="PRODUCT_SUMMARY" />
		<result property="product_KeyWords" column="PRODUCT_KEYWORDS" />
		<result property="product_Status" column="PRODUCT_STATUS" />
		<result property="name" column="NAME" />
		<result property="no" column="NO" />
		<result property="top" column="TOP" />
		<result property="recommend" column="RECOMMEND" />
		<result property="hot" column="HOT" />
		<result property="brandName" column="B_NAME" />
		<result property="title" column="TITLE" />
		<result property="imgeId" column="IMAGEID" />
		<result property="release_Time" column="RELEASE_TIME" />
		<result property="created_Time" column="CREATED_TIME" />
		<result property="imgUrl" column="IMGURL" />
		<collection property="productTypeList"
			ofType="cn.cebest.entity.system.product.Product_Type">
			<id property="id" column="ID_" />
			<result property="type_name" column="type_name" />
		</collection>
	</resultMap>
	<resultMap type="cn.cebest.entity.system.product.Brand" id="resultBrand">
		<id property="id" column="bid" />
		<result property="name" column="BNAME" />
		<result property="pid" column="BPID" />
		<result property="title" column="BTITLE" />
		<result property="imgurl" column="BIMGURL" />
		<collection property="productList" resultMap="baseResultProduct"></collection>
	</resultMap>
	
	<select id="findProductTypeList" resultType="pd">
		SELECT 
			T.ID,T.TYPE_NAME
		FROM 
			WEB_PRODUCT_TYPE T
		LEFT JOIN
			WEB_PRODUCTTYPE_COLUMN C
		ON
			C.PRDUCTTYPEID = T.ID
		WHERE
			C.COLUMNID = #{columnId}
		ORDER BY T.SORT
	</select>
	
	<select id="findProductslistPage" resultType="pd">
		SELECT 
			P.ID,I.IMGURL,P.NAME,TPR.COLUMNID AS COLUMNID,P.PRODUCT_SUMMARY,T.TXT,P.FILEDJSON
		FROM WEB_PRODUCT P
		LEFT JOIN
			WEB_IMAGE I 
		ON 
			I.IMAGE_ID = P.IMAGEID
		LEFT JOIN 
			WEB_TYPE_PRODUCT_RELATION TPR 
		ON 
			TPR.PRODUCTID = P.ID
		LEFT JOIN 
			WEB_TXT T
		ON 
			T.CONTENT_ID = P.ID
		WHERE
			TPR.COLUMNID=#{pd.columId}
			<if test="pd.typeId !=null and pd.typeId !='' and pd.typeId != pd.columId">and TPR.PRODUCTTYPEID=#{pd.typeId}</if>
			<if test="pd.prouctId !=null and pd.prouctId !='' ">and P.ID!=#{pd.prouctId}</if>
			<if test="pd.recommend !=null and pd.recommend !='' ">and P.RECOMMEND=#{pd.recommend}</if>
			<if test="pd.area !=null and pd.area !='' ">and P.AREA=#{pd.area}</if>
			<if test="pd.name !=null and pd.name !='' ">
				and 
					P.NAME LIKE '%' #{pd.name} '%'
				or
					P.PRODUCT_SUMMARY LIKE '%' #{pd.name} '%'
			</if>
			ORDER BY P.SORT
	</select>
	
	<select id="getProductByIdlistpage" resultType="pd">
		SELECT 
			P.ID,I.IMGURL,P.NAME,TPR.COLUMNID AS COLUMNID
		FROM WEB_PRODUCT P
		LEFT JOIN
			WEB_IMAGE I 
		ON 
			I.IMAGE_ID = P.IMAGEID
		LEFT JOIN 
			WEB_TYPE_PRODUCT_RELATION TPR 
		ON 
			TPR.PRODUCTID = P.ID
		WHERE
			TPR.COLUMNID IN
			<foreach collection="ids" item="id" close=")" open="(" separator=",">
				#{id}
			</foreach>
			<if test="name !=null and name !='' ">
				and 
					P.NAME LIKE '%' #{name} '%'
				or
					P.PRODUCT_SUMMARY LIKE '%' #{name} '%'
			</if>
			ORDER BY P.SORT
	</select>
	
	<!--  -->
	<select id="selectProductTypeById" resultMap="resultProduct">
		SELECT DISTINCT P.ID,P.NAME,PT.ID AS ID_,PT.TYPE_NAME
		FROM WEB_PRODUCT
		P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT
		JOIN WEB_PRODUCT_TYPE PT ON PT.ID=TPR.PRODUCTTYPEID
		WHERE P.ID in
		<foreach collection="array" item="productid01" close=")" open="("
			separator=",">
			#{productid01}
		</foreach>
	</select>
	<select id="findProducts" resultType="pd">
		SELECT
			 P.ID,I.IMGURL,WTPR.COLUMNID,V.VIDEO_URL
		FROM 
			WEB_PRODUCT P
		LEFT JOIN
			WEB_IMAGE	I
		ON	
			I.IMAGE_ID=P.IMAGEID
		LEFT JOIN
			WEB_TYPE_PRODUCT_RELATION	WTPR
		ON	
			WTPR.PRODUCTID=P.ID
		LEFT JOIN
			WEB_VIDEO	V
		ON	
			V.MASTER_ID=P.ID
		WHERE
			1=1
		<if test="HOT != '' and HOT != null ">
			AND	P.HOT = #{HOT}
		</if>
		ORDER BY SORT
	</select>

	<!-- ceshikaishi -->
	<select id="selectTestlistPage" parameterType="page" resultType="string">
		SELECT DISTINCT P.ID
		FROM WEB_PRODUCT P
		<if test="(pd.typeId !=null and pd.typeId != '') or (pd.columId !=null and pd.columId != '')">
			LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		</if>
		<where>
			P.SITEID=#{pd.SITEID}
			<if test="pd.PRODUCT_KEYWORDS !=null and pd.PRODUCT_KEYWORDS != ''">
				AND P.NAME LIKE '%' #{pd.PRODUCT_KEYWORDS}
				'%'
			</if>
			<if test="pd.typeId !=null and pd.typeId != ''">
				AND TPR.PRODUCTTYPEID=#{pd.typeId}
			</if>
			<if test="pd.columId !=null and pd.columId != ''">
				AND TPR.COLUMNID=#{pd.columId}
			</if>
		</where>
		<if test="pd.CREATED_TIME_DESC !=null and pd.CREATED_TIME_DESC != ''">
			ORDER BY P.CREATED_TIME DESC
		</if>
		<if test="pd.CREATED_TIME_ASC !=null and pd.CREATED_TIME_ASC != ''">
			ORDER BY P.CREATED_TIME ASC
		</if>
		<if test="pd.NAME_DESC !=null and pd.NAME_DESC != ''">
			ORDER BY P.NAME DESC
		</if>
		<if test="pd.NAME_ASC !=null and pd.NAME_ASC != ''">
			ORDER BY P.NAME ASC
		</if>
		<if test="pd.NO_DESC !=null and pd.NO_DESC != ''">
			ORDER BY P.NO DESC
		</if>
		<if test="pd.NO_ASC !=null and pd.NO_ASC != ''">
			ORDER BY P.NO ASC
		</if>
		<if test="pd.UPDATE_TIME !=null and pd.UPDATE_TIME !=''">
			ORDER BY P.UPDATE_TIME DESC
		</if>
	</select>
	<select id="selectTest" parameterType="pd" resultMap="resultProduct">
		SELECT
		P.ID,P.NO,P.NAME,P.IMAGEID,Y.TYPE_NAME,P.CREATED_TIME,P.PRODUCT_STATUS,Y.ID
		AS ID_,I.IMGURL,P.HOT,P.RECOMMEND,P.TOP
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT JOIN
		WEB_PRODUCT_TYPE Y ON TPR.PRODUCTTYPEID=Y.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		where P.ID IN
		<foreach collection="ids" close=")" item="productid02" open="("
			separator=",">
			#{productid02}
		</foreach>
		<if test="CREATED_TIME_DESC !=null and CREATED_TIME_DESC != ''">
			ORDER BY P.CREATED_TIME DESC
		</if>
		<if test="CREATED_TIME_ASC !=null and CREATED_TIME_ASC != ''">
			ORDER BY P.CREATED_TIME ASC
		</if>
		<if test="NAME_DESC !=null and NAME_DESC != ''">
			ORDER BY P.NAME DESC
		</if>
		<if test="NAME_ASC !=null and NAME_ASC != ''">
			ORDER BY P.NAME ASC
		</if>
		<if test="NO_DESC !=null and NO_DESC != ''">
			ORDER BY P.NO DESC
		</if>
		<if test="NO_ASC !=null and NO_ASC != ''">
			ORDER BY P.NO ASC
		</if>
		<if test="UPDATE_TIME !=null and UPDATE_TIME !=''">
			ORDER BY P.UPDATE_TIME DESC
		</if>

	</select>
	<!-- ceshijieshu -->
	<!-- 查询产品列表 -->
	<select id="findProductlistPage" parameterType="page" resultMap="resultProduct">
		SELECT
		P.ID,P.NO,P.NAME,P.IMAGEID,Y.TYPE_NAME,P.CREATED_TIME,P.PRODUCT_STATUS,Y.ID
		AS ID_,I.IMGURL,P.HOT,P.RECOMMEND,P.TOP
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT JOIN
		WEB_PRODUCT_TYPE Y ON TPR.PRODUCTTYPEID=Y.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		<where>
			P.SITEID=#{pd.SITEID}
			<if test="pd.PRODUCT_KEYWORDS !=null and pd.PRODUCT_KEYWORDS != ''">
				AND P.PRODUCT_KEYWORDS LIKE '%' #{pd.PRODUCT_KEYWORDS}
				'%'
			</if>
			<if test="pd.typeId !=null and pd.typeId != ''">
				AND Y.ID=#{pd.typeId}
			</if>
		</where>
		ORDER BY P.TOP DESC,P.RECOMMEND DESC,P.RECOMMEND_TIME DESC,P.TOP_TIME
		DESC
	</select>

	<select id="findProductSortlistPage" parameterType="page"
		resultMap="resultProduct">
		SELECT
		P.ID,P.NO,P.NAME,P.IMAGEID,Y.TYPE_NAME,P.CREATED_TIME,P.PRODUCT_STATUS,Y.ID
		AS ID_,I.IMGURL
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT JOIN
		WEB_PRODUCT_TYPE Y ON TPR.PRODUCTTYPEID=Y.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		<where>
			P.SITEID=#{pd.SITEID}
			<if test="pd.PRODUCT_KEYWORDS !=null and pd.PRODUCT_KEYWORDS != ''">
				AND P.PRODUCT_KEYWORDS LIKE '%' #{pd.PRODUCT_KEYWORDS}
				'%'
			</if>
			<if test="pd.typeId !=null and pd.typeId != ''">
				AND Y.ID=#{pd.typeId}
			</if>
		</where>
		<if test="pd.CREATED_TIME_DESC !=null and pd.CREATED_TIME_DESC != ''">
			ORDER BY P.CREATED_TIME DESC
		</if>
		<if test="pd.CREATED_TIME_ASC !=null and pd.CREATED_TIME_ASC != ''">
			ORDER BY P.CREATED_TIME ASC
		</if>
		<if test="pd.NAME_DESC !=null and pd.NAME_DESC != ''">
			ORDER BY P.NAME DESC
		</if>
		<if test="pd.NAME_ASC !=null and pd.NAME_ASC != ''">
			ORDER BY P.NAME ASC
		</if>
		<if test="pd.NO_DESC !=null and pd.NO_DESC != ''">
			ORDER BY P.NO DESC
		</if>
		<if test="pd.NO_ASC !=null and pd.NO_ASC != ''">
			ORDER BY P.NO ASC
		</if>
	</select>

	<!-- 查询商品详情模板 -->
	<select id="selectProductTemplate" parameterType="pd"
		resultType="pd">
		SELECT TEM_NAME,ID
		FROM WEB_TEMPLATE
		WHERE TEM_TYPE=
		#{TEMPLATE_TYPE_3}
		AND TYPE='2'
	</select>
	
	<select id="selectFproduct" resultType="pd">
		SELECT ID,NAME
		FROM WEB_PRODUCT
		WHERE BRANDID IN 
		<foreach collection="array" close=")" open="(" item="productid03" separator=",">
			#{productid03}
		</foreach>
	</select>
	
	<select id="selectFproductByprid" resultType="pd">
		SELECT P.ID,P.NAME
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_P_F PF ON PF.FPRODUCTID=P.ID
		WHERE PF.PRODUCTID=#{ID} 
		
	</select>
	<!-- 查询所有品牌 -->
	<select id="selectBrandAll" resultType="cn.cebest.entity.system.product.Brand">
		SELECT ID,NAME,PID
		FROM
		WEB_BRAND
	</select>
	<!-- 查询所有类型id,和名称 -->
	<select id="selectProductType" parameterType="pd" resultType="pd">
		SELECT ID,TYPE_NAME
		FROM WEB_PRODUCT_TYPE
		WHERE SITEID=#{SITEID}
	</select>

	<!-- 保存品牌 -->
	<insert id="insertBrand" parameterType="pd">
		INSERT INTO
		WEB_BRAND(ID,NAME,PID,SITEID,IMAGEID,CREATE_TIME)
		VALUES(#{id},#{name},#{pid},#{siteid},#{productImageId},#{createTime})
	</insert>
	
	<!-- 查询根品牌 -->
	<select id="selectBrandTopList" parameterType="pd" resultType="cn.cebest.entity.system.product.Brand">
		SELECT
		ID,NAME,PID
		FROM WEB_BRAND
		WHERE PID= '0'
		and SITEID=#{SITEID}
	</select>
	<!-- 查询所有品牌 -->
	<select id="selectBrandAllList" parameterType="pd" resultType="cn.cebest.entity.system.product.Brand">
		SELECT
		ID,NAME,PID
		FROM WEB_BRAND
		where SITEID=#{SITEID}
	</select>
	<!-- 查询所有品牌 -->
	<select id="selectBrandById" resultType="cn.cebest.entity.system.product.Brand">
		SELECT
		P.ID,P.NAME,P.PID,P.IMAGEID,I.IMGURL,I.TITLE
		FROM
		WEB_BRAND P
		LEFT JOIN  WEB_IMAGE I 
		ON I.IMAGE_ID=P.IMAGEID
		where id=#{id}
	</select>
	<!-- 根据产品的id查询图片的路径 -->
	<select id="selectImagePachByBrandId" resultType="pd">
		SELECT I.IMGURL,I.IMAGE_ID
		FROM WEB_BRAND P
		LEFT JOIN WEB_IMAGE I ON
		P.IMAGEID=I.IMAGE_ID
		WHERE P.ID IN
		<foreach collection="array" item="productid04" open="(" close=")"
			separator=",">
			<if test="id !=null and id != ''">
				#{productid04}
			</if>
		</foreach>
	</select>
	<!-- ==================================================== -->
	<!-- 根据产品类型id查询商品 -->
	<select id="selectProductBytypeId" resultMap="resultProduct">
		SELECT DISTINCT P.ID,P.NAME,PT.ID AS ID_,PT.TYPE_NAME
		FROM WEB_PRODUCT
		P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT
		JOIN WEB_PRODUCT_TYPE PT ON PT.ID=TPR.PRODUCTTYPEID
		WHERE PT.ID in
		<foreach collection="array" item="productid05" close=")" open="("
			separator=",">
			#{productid05}
		</foreach>
	</select>
	<!-- 保存产品和产品关系 -->
	<insert id="insertType_product_relation" parameterType="cn.cebest.entity.system.product.Product">
			INSERT INTO
			WEB_TYPE_PRODUCT_RELATION(PRODUCTID,PRODUCTTYPEID,COLUMNID) VALUES
			<foreach collection="objKey_Value" item="productid06" open=""
				separator="," close="">
				(#{id},#{productid06.values},#{productid06.key})
			</foreach>
	</insert>
	
	<!-- 查询改内容分类的地址栏URL信息 -->
	<select id="findContentUrlNameList" parameterType="cn.cebest.entity.system.product.Product" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM WEB_SKIPPATH 
		WHERE CONTENTID = #{id}
	</select>
	
	<!-- 修改栏目url信息 -->
	<update id="editContentUrlNameconfig" parameterType="cn.cebest.entity.system.product.Product" >
		UPDATE WEB_SKIPPATH
		<set>
			<foreach collection="objKey_Value" item="item" open=""
				separator="," close="">
				<if test="item.key!=null and item.key!=''">
					COLUMNID			= #{item.key}
				</if>
				<if test="item.values!=null and item.values!=''">
					,TYPEID			= #{item.values}
				</if>
			</foreach>
		</set>
		WHERE 
			CONTENTID 			= #{id}
		<foreach collection="objKey_Value" item="item" open=""
			separator="," close="">
			<if test="item.key!=null and item.key!=''">
				AND COLUMNID			= #{item.key}
			</if>
			<if test="item.values!=null and item.values!=''">
				AND TYPEID			= #{item.values}
			</if>
		</foreach>
	</update>
	
	<!-- 保存产品和产品关系 -->
	<insert id="insertType_product_relation2" parameterType="cn.cebest.entity.system.product.Product">
		<if test="producttypeids !=null and producttypeids.length>0">
			INSERT INTO WEB_TYPE_PRODUCT_RELATION(PRODUCTID,PRODUCTTYPEID) VALUES
			<foreach collection="producttypeids" item="productid07" open=""
				separator="," close="">
				(#{id},#{productid07})
			</foreach>
		</if>
	</insert>

	<!-- 删除产品和产品关系 -->
	<delete id="deleteType_product_relation">
		DELETE FROM WEB_TYPE_PRODUCT_RELATION
		WHERE PRODUCTID IN
		<foreach collection="array" item="productid08" close=")" open="("
			separator=",">
			#{productid08}
		</foreach>
	</delete>

	<!-- 保存图片 -->
	<insert id="saveImage" parameterType="pd">
		insert into WEB_IMAGE(
		IMAGE_ID,TITLE,IMGURL,TYPE,BZ
		) values (
		#{productImageId},#{productTitle},#{productImageUrl},6,#{bz}
		)
	</insert>
	<!-- 保存图片 -->
	<insert id="saveImage2" parameterType="pd">
		insert into WEB_IMAGE(
		IMAGE_ID,TITLE,IMGURL,TYPE,BZ
		) values (
		#{productImageId2},#{productTitle2},#{productImageUrl2},6,#{bz2}
		)
	</insert>
	<!-- 批量添加图片 -->
	<insert id="saveImages" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO
		WEB_IMAGE(IMAGE_ID,TITLE,IMGURL,TOURL,TYPE,FORDER,BZ,MASTER_ID) VALUES
		<foreach collection="timageList" item="image" open=""
			separator="," close="">
			(#{image.imageId},#{image.title},#{image.imgurl},#{image.tourl},6,#{image.forder},#{image.bz},#{image.master_id})
		</foreach>
	</insert>
	<!-- 保存产品 -->
	<insert id="saveProduct" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO WEB_PRODUCT
		(ID,FILEDJSON,SITEID,PRODUCT_TEMPLATEID,PRODUCT_WBURL,PRODUCT_SUMMARY,PRODUCT_KEYWORDS,CREATED_TIME,UPDATE_TIME,PRODUCT_STATUS,NAME,NO,BRANDID,RECOMMEND,HOT,IMAGEID,RELEASE_TIME,VALUETEXT,TOP,TOP_TIME,RECOMMEND_TIME,AREA,FLAG)
		VALUES
		(#{id},#{filedJson},#{siteId},#{product_TemplateId},#{product_WbUrl},#{product_Summary},#{product_KeyWords},#{created_Time},#{update_Time},#{product_Status},#{name},#{no},#{brandId},#{recommend},#{hot},#{imgeId},#{release_Time},#{valueText},#{top},#{top_time},#{recommend_time},#{area},#{flag})
	</insert>
	
	<insert id="saveProductF" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO WEB_P_F(PRODUCTID,FPRODUCTID)
		VALUES
	<foreach collection="fproductids" close="" open="" separator="," item="productid">
		(#{id},#{productid})
	</foreach>
	</insert>
	
	<delete id="deleteProductF" >
	DELETE FROM WEB_P_F
	WHERE PRODUCTID IN
	<foreach collection="array" close=")" open="(" separator="," item="productid09">
		#{productid09}
	</foreach>
	</delete>
	
	<select id="selectBrands" resultType="String">
		select BRANDID
		from WEB_PRODUCT_BRAND
		where PRODUCTID=#{id}
	</select>
	<!-- 保存相关联产品关系 -->
	<insert id="saveProductRelevant" parameterType="cn.cebest.entity.system.product.Product">
		<if test="productRelevantIdList !=null and productRelevantIdList.length>0">
			INSERT INTO WEB_PRODUCT_RELEVANT(PRODUCTID,RELEVANTID) VALUES
			<foreach collection="productRelevantIdList" item="productRelevantId"
				open="" separator="," close="">
				(#{id},#{productRelevantId})
			</foreach>
		</if>
	</insert>
	
	<insert id="saveProductBrand" parameterType="cn.cebest.entity.system.product.Product">
			INSERT INTO WEB_PRODUCT_BRAND(PRODUCTID,BRANDID) VALUES
			<foreach collection="brandIds" item="brandId"
				open="" separator="," close="">
				(#{id},#{brandId})
			</foreach>
	</insert>
	<!-- 删除图片 -->
	<delete id="deleteProductImage">
		DELETE FROM WEB_IMAGE
		WHERE IMAGE_ID IN
		<foreach collection="array" close=")" item="productid10" open="("
			separator=",">
			#{productid10}
		</foreach>
	</delete>
	<!-- 修改图片 -->
	<update id="updateProductImage" parameterType="pd">
		UPDATE WEB_IMAGE
		SET IMGURL=#{productImageUrl}
		WHERE IMAGE_ID=#{productImageId}
	</update>
	<!-- 批量添加视频 -->
	<insert id="savevideos" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO
		WEB_VIDEO(ID,VIDEO_TITLE,VIDEO_CONTENT,TOURL,VIDEO_URL,VIDEO_TYPE,CREATETIME,MASTER_ID)
		VALUES
		<foreach collection="tvideoList" item="video" open=""
			separator="," close="">
			(#{video.id},#{video.video_title},#{video.video_content},#{video.tourl},#{video.video_url},#{video.video_type},#{video.createtime},#{video.master_id})
		</foreach>
	</insert>
	<!-- 批量添加视频 -->
	<insert id="1savevideos" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO
		WEB_VIDEO(ID,VIDEO_TITLE,VIDEO_CONTENT,TOURL,VIDEO_URL,VIDEO_TYPE,CREATETIME,MASTER_ID)
		VALUES
		<foreach collection="videoList" item="video" open=""
			separator="," close="">
			(#{video.id},#{video.video_title},#{video.video_content},#{video.tourl},#{video.video_url},#{video.video_type},#{video.createtime},#{video.master_id})
		</foreach>
	</insert>
	<!-- 删除相关联产品关系 -->
	<delete id="deleteProductRelevant">
		DELETE FROM
		WEB_PRODUCT_RELEVANT WHERE PRODUCTID =
		#{id}
	</delete>
	<!-- 批量删除相关联产品关系 -->
	<delete id="deleteProductRelevantList">
		DELETE FROM WEB_PRODUCT_RELEVANT WHERE PRODUCTID in
		<foreach collection="array" item="productid11" close=")" open="("
			separator=",">
			#{productid11}
		</foreach>
	</delete>
	
	<delete id="deleteProductBrand">
		DELETE FROM WEB_PRODUCT_BRAND WHERE PRODUCTID in
		<foreach collection="array" item="productid12" close=")" open="("
			separator=",">
			#{productid12}
		</foreach>
	</delete>
	<!-- 删除产品 -->
	<delete id="deleteProduct">
		DELETE FROM WEB_PRODUCT
		WHERE ID IN
		<foreach collection="array" item="productid13" open="(" close=")"
			separator=",">
			#{productid13}
		</foreach>
	</delete>
	<!-- 保存富文本 -->
	<insert id="saveProductTxt" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO
		WEB_TXT(CONTENT_ID,txt)
		VALUES(#{id},#{productTxt})
	</insert>

	<!-- 刪除富文本 -->
	<delete id="deleteProductTxt">
		DELETE FROM WEB_TXT
		WHERE CONTENT_ID IN
		<foreach collection="array" item="productid14" open="(" close=")"
			separator=",">
			#{productid14}
		</foreach>
	</delete>

	<!-- 修改富文本 -->
	<update id="upateProductTxt" parameterType="cn.cebest.entity.system.product.Product">
		UPDATE
		WEB_TXT
		SET
		TXT=#{productTxt}
		WHERE CONTENT_ID =#{id}
	</update>


	<!-- 根据id查询相关产品 -->
	<select id="selectProductRelevant" resultMap="resultProduct">
		SELECT
		P2.ID,
		P2.NAME,
		PT.TYPE_NAME
		FROM WEB_PRODUCT P2
		LEFT JOIN WEB_PRODUCT_RELEVANT PR ON PR.RELEVANTID=P2.ID
		LEFT JOIN
		WEB_PRODUCT P1 ON PR.PRODUCTID=P1.ID
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P2.ID
		LEFT JOIN WEB_PRODUCT_TYPE PT ON PT.ID=TPR.PRODUCTTYPEID
		WHERE P1.ID=#{id}
	</select>

	<!-- 根据产品的id查询图片的路径 -->
	<select id="selectImagePachByProductId" resultType="pd">
		SELECT I.IMGURL,I.IMAGE_ID
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_IMAGE I ON
		P.IMAGEID=I.IMAGE_ID
		WHERE P.ID IN
		<foreach collection="array" item="productid15" open="(" close=")"
			separator=",">
			<if test="productid15 !=null and productid15 != ''">
				#{productid15}
			</if> 
		</foreach>
	</select>
	
	
	<!-- begin -->
	<!-- 根據id查詢 -->
	<select id="selectProductById" resultMap="baseResultProduct">
		SELECT
		P.ID,TPR.PRODUCTTYPEID AS TYPEID,P.PRODUCT_TEMPLATEID,P.AREA,PTY.ID AS
		TID_,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_KEYWORDS,P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.VALUE_TYPE,P.HOT,P.RECOMMEND,P.IMAGEID,P.RELEASE_TIME,PT.TXT,P.VALUETEXT
		,I.TITLE,PTY.TYPE_NAME AS
		TYPE_NAME_,T.TEM_NAME,B.NAME AS
		BRANDNAME,I.IMGURL,P.FILEDJSON,
		CC.ID AS COLUMNID_,CC.COLUM_NAME AS COLUMNAME_,
		I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL
		AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,I2.FORDER AS forder_,
		V.ID AS VIDEO_ID_,V.VIDEO_TITLE AS VIDEO_TITLE_,V.VIDEO_TYPE AS
		VIDEO_TYPE_,V.VIDEO_URL AS VIDEO_URL_,V.VIDEO_CONTENT AS
		VIDEO_CONTENT_,V.TOURL AS VIDEO_TOURL,P.FLAG,WS.ID AS contentUrlName,
		S.SEO_TITLE AS STITLE
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TXT
		PT
		ON P.ID=PT.CONTENT_ID
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON
		TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_PRODUCT_TYPE PTY ON
		PTY.ID=TPR.PRODUCTTYPEID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		LEFT JOIN WEB_SEO S ON S.MASTER_ID=P.ID
		LEFT JOIN WEB_TEMPLATE T ON P.PRODUCT_TEMPLATEID=T.ID
		LEFT JOIN WEB_BRAND B
		ON B.ID=P.BRANDID
		LEFT JOIN WEB_COLUMCONFIG CC ON CC.ID=TPR.COLUMNID
		LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
		LEFT JOIN WEB_VIDEO V ON V.MASTER_ID=P.ID
		LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
		WHERE P.ID= #{id}
		ORDER BY I2.FORDER ASC
	</select>
	<!-- end -->
	<!-- 查询相同类型的产品 -->
	<select id="selectProductRelevantBycode" resultType="pd">
		SELECT
		P.ID,P.NAME
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR
		ON TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_PRODUCT_TYPE PTY ON
		PTY.ID=TPR.PRODUCTTYPEID
		WHERE PTY.ID= #{id}
	</select>


	<!--修改产品 -->
	<update id="updateProduct" parameterType="cn.cebest.entity.system.product.Product">
		UPDATE WEB_PRODUCT
		<set>
			<if test="product_TemplateId !=null and product_TemplateId !='' ">product_TemplateId=#{product_TemplateId},</if>
			product_WbUrl=#{product_WbUrl},
			product_Summary=#{product_Summary},
			product_KeyWords=#{product_KeyWords},
			product_Status=#{product_Status},
			recommend=#{recommend},
			hot=#{hot},
			top=#{top},
			no=#{no},
			filedjson=#{filedJson},
			<if test="name !=null and name !=''">name=#{name},</if>
			<if test="brandId !=null and brandId !=''">brandId=#{brandId},</if>
			<if test="imgeId !=null and imgeId !=''">imageid=#{imgeId},</if>
			<if test="release_Time !=null and release_Time !=''">release_Time=#{release_Time},</if>
			<if test="valueText !=null and valueText !=''">valueText=#{valueText},</if>
			<if test="update_Time !=null and update_Time !=''">update_time=#{update_Time},</if>
			<if test="area !=null and area !=''">area=#{area}</if>
		</set>
		WHERE ID=#{id}
	</update>
	<update id="updateProductStatusByIds" parameterType="HashMap">
		UPDATE WEB_PRODUCT P1
		SET P1.PRODUCT_STATUS= ${status}
		WHERE
		P1.ID IN
		<foreach collection="ids" item="productid16" close=")" open="("
			separator=",">
			#{productid16}
		</foreach>

	</update>
	<!-- 修改状态与置顶 -->
	<update id="updataRecommendAndTopByIds" parameterType="cn.cebest.entity.system.product.Product">
		UPDATE WEB_PRODUCT
		<set>
			<if test="recommend_time !=null and recommend_time !=''">recommend=#{recommend},</if>
			<if test="recommend_time !=null and recommend_time !=''">recommend_time=#{recommend_time},</if>
			<if test="top_time !=null and top_time !=''">top=#{top},</if>
			<if test="top_time !=null and top_time !=''">top_time=#{top_time}</if>
		</set>
		WHERE ID IN
		<foreach collection="productRelevantIdList" item="productid17" close=")"
			open="(" separator=",">
			#{productid17}
		</foreach>
	</update>

	<select id="selectProduct" parameterType="pd" resultMap="baseResultProduct">
		SELECT P.PRODUCT_WBURL,B.`NAME` AS B_NAME,
		P.ID,P.PRODUCT_TEMPLATEID,T.TEM_NAME ,PTY.ID AS
		TID_,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_KEYWORDS,P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.VALUE_TYPE,P.HOT,P.RECOMMEND,P.IMAGEID,P.RELEASE_TIME,P.VALUETEXT
		,I.TITLE,PTY.TYPE_NAME AS TYPE_NAME_,P.CREATED_TIME,P.UPDATE_TIME
		FROM
		WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON
		TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_PRODUCT_TYPE PTY ON
		PTY.ID=TPR.PRODUCTTYPEID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		LEFT JOIN WEB_TEMPLATE T ON P.PRODUCT_TEMPLATEID=T.ID
		LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
		WHERE P.SITEID=#{SITEID} AND P.ID IN
		<foreach collection="ids" item="productid18" close=")" open="("
			separator=",">
			#{productid18}
		</foreach>
	</select>
	<!-- 批量添加 -->
	<insert id="batchInsertProduct" parameterType="list">
		INSERT INTO WEB_PRODUCT
		(ID,SITEID,PRODUCT_TEMPLATEID,PRODUCT_WBURL,PRODUCT_SUMMARY,PRODUCT_KEYWORDS,CREATED_TIME,PRODUCT_STATUS,NAME,NO,BRANDID,RECOMMEND,HOT,IMAGEID,RELEASE_TIME,VALUETEXT,TOP,TOP_TIME,RECOMMEND_TIME,UPDATE_TIME)
		VALUES
		<foreach collection="list" item="product" close="" open=""
			separator=",">
			(#{product.id},#{product.siteId},#{product.product_TemplateId},#{product.product_WbUrl},#{product.product_Summary},#{product.product_KeyWords},#{product.created_Time},#{product.product_Status},#{product.name},#{product.no},#{product.brandId},#{product.recommend},#{product.hot},#{product.imgeId},#{product.release_Time},#{product.valueText},#{product.top},#{product.top_time},#{product.recommend_time},#{product.update_Time})
		</foreach>
	</insert>
	<!-- 验证编号 -->
	<select id="selectNoCount" parameterType="HashMap" resultType="Integer">
		SELECT COUNT(*)
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION
		TPR ON TPR.PRODUCTID=P.ID
		WHERE NO=#{no}
		AND TPR.PRODUCTTYPEID IN
		<foreach collection="typeid" item="productid19" close=")" open="("
			separator=",">
			#{productid19}
		</foreach>
	</select>
	<!-- 查询属性id和pid -->
	<select id="selectAllIdPiD" parameterType="pd" resultType="HashMap">
		SELECT ID,PID
		FROM WEB_PRODUCT_VALUETYPE
	</select>
	<!-- 查询品牌id和pid -->
	<select id="selectBrandAllIdPiD" parameterType="pd" resultType="HashMap">
		SELECT ID,PID
		FROM WEB_BRAND
	</select>
	<!-- 删除品牌 -->
	<delete id="deleteBrand">
		DELETE FROM WEB_BRAND
		WHERE ID IN
		<foreach collection="array" close=")" item="productid20" open="("
			separator=",">
			#{productid20}
		</foreach>
	</delete>
	<!-- 删除属性 -->
	<delete id="deleteProperty">
		DELETE FROM WEB_PRODUCT_VALUETYPE
		WHERE ID IN
		<foreach collection="array" close=")" item="productid21" open="("
			separator=",">
			#{productid21}
		</foreach>
	</delete>
	<!-- 修改属性 -->
	<update id="updateProperty" parameterType="pd">
		UPDATE
		WEB_PRODUCT_VALUETYPE
		SET NAME=#{name},
		PID=#{pid}
		WHERE ID=#{id}
	</update>
	<!-- 修改品牌 -->
	<update id="updateBrand" parameterType="pd">
		UPDATE WEB_BRAND
		SET
		NAME=#{name},
		PID=#{pid},
		IMAGEID=#{productImageId}
		WHERE ID=#{id}
	</update>
	<!-- 根据栏目id查询类型id -->
	<select id="selectTypeId" resultType="String">
		SELECT PT.ID
		FROM WEB_PRODUCT_TYPE PT
		LEFT JOIN WEB_PRODUCTTYPE_COLUMN PC ON
		PC.PRDUCTTYPEID=PT.ID
		WHERE PC.COLUMNID=#{id}
	</select>
	<!-- 根据产品类型id查询商品 -->
	<select id="selectProductBytypeIds" parameterType="pd"
		resultType="cn.cebest.entity.system.product.Product">
		SELECT DISTINCT P.ID,P.NAME,P.CREATED_TIME
		FROM WEB_PRODUCT P
		LEFT JOIN
		WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		WHERE P.TOP=#{TOP}
		AND P.TOP_TIME &gt; #{TIME} AND TPR.PRODUCTTYPEID in
		<foreach collection="ids" item="productid22" close=")" open="("
			separator=",">
			#{productid22}
		</foreach>
	</select>

	<!-- 根据条件查询文件类型 -->
	<select id="selectAllByAll" parameterType="HashMap"
		resultType="cn.cebest.entity.system.product.Product">
		SELECT
		P.ID,P.PRODUCT_WBURL,P.NAME,PT.TXT,P.PRODUCT_SUMMARY
		FROM
		WEB_PRODUCT P
		LEFT JOIN WEB_TXT PT
		ON P.ID=PT.CONTENT_ID
		<where>
			<if test="SITEID !null and SITEID !=''">and SITEID=#{SITEID}</if>
		</where>
	</select>
	<!-- 查询各个栏目下置顶的产品 -->
	<select id="findTopContentList" resultType="pd">
		SELECT P.ID,P.NAME,P.CREATED_TIME,P.TOP_TIME,TC.COLUMNID
		FROM WEB_PRODUCT P
		INNER JOIN
		WEB_TYPE_PRODUCT_RELATION TP ON TP.PRODUCTID=P.ID
		INNER JOIN
		WEB_PRODUCTTYPE_COLUMN TC ON TC.PRDUCTTYPEID=TP.PRODUCTTYPEID
		WHERE
		P.TOP='1'
	</select>

	<!-- 根据id查询模板路径 -->
	<select id="selectTemplatePachById" resultType="pd">
		SELECT T.TEM_FILEPATH as template_Path
		FROM WEB_TEMPLATE T
		LEFT JOIN
		WEB_PRODUCT P ON T.ID=P.PRODUCT_TEMPLATEID
		WHERE P.ID=#{id}
	</select>
	
	<!-- 根据栏目id查询产品 -->
	<select id="selectProductByColumnIdlistPage" parameterType="page" resultMap="baseResultProduct">
		SELECT
		P.ID,P.PRODUCT_TEMPLATEID,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.VALUE_TYPE,P.HOT,P.RECOMMEND,P.IMAGEID,P.RELEASE_TIME,P.AREA
		,I.TITLE AS title_,I.IMGURL AS imgurl_,P.FILEDJSON,TPR.COLUMNID AS COLUMNID,T.TXT AS TXT,II.IMGURL AS IMGURL,WS.ID AS contentUrlName,I.FORDER AS forder_
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON				
		TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_IMAGE I ON I.MASTER_ID=P.ID
		LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
		LEFT JOIN WEB_IMAGE II ON II.IMAGE_ID=P.IMAGEID
		LEFT JOIN WEB_TXT T ON T.CONTENT_ID=P.ID
		<where>
			TPR.COLUMNID=#{pd.columId}
			<if test="pd.typeId !=null and pd.typeId !='' and pd.typeId != pd.columId">and TPR.PRODUCTTYPEID=#{pd.typeId}</if>
			<if test="pd.prouctId !=null and pd.prouctId !='' ">and P.ID!=#{pd.prouctId}</if>
			<if test="pd.recommend !=null and pd.recommend !='' ">and P.RECOMMEND=#{pd.recommend}</if>
			<if test="pd.area !=null and pd.area !='' ">and P.AREA=#{pd.area}</if>
			<if test="pd.name !=null and pd.name !='' ">
				and 
					P.NAME LIKE '%' #{pd.name} '%'
				or
					P.PRODUCT_SUMMARY LIKE '%' #{pd.name} '%'
			</if>
		</where>
		ORDER BY P.SORT,I.FORDER
	</select>
	
	<!-- 根据栏目id查询推荐产品 -->
	<select id="findRecommendProductByColumnId" resultMap="baseResultProduct">
		SELECT
		P.ID,P.PRODUCT_TEMPLATEID,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.VALUE_TYPE,P.HOT,P.RECOMMEND,P.IMAGEID,P.RELEASE_TIME,P.RECOMMEND_TIME,
		I.TITLE,I.IMGURL,P.FILEDJSON,PT.TXT,WS.ID AS contentUrlName
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TXT PT
		ON P.ID=PT.CONTENT_ID
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON
		TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
		WHERE TPR.COLUMNID=#{ID} and P.RECOMMEND='1' ORDER BY P.RECOMMEND_TIME DESC
		LIMIT 0,6
	</select>
	
	<!-- 根据栏目Id查询排除当前类型Id获取其他系列产品列表-->
	<select id="findProductColumnIdExcludeByTypeId" parameterType="pd" resultMap="baseResultProduct">
		SELECT
		P.ID,P.PRODUCT_TEMPLATEID,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.VALUE_TYPE,P.HOT,P.RECOMMEND,P.IMAGEID,P.RELEASE_TIME
		,I.TITLE,I.IMGURL,P.FILEDJSON,WS.ID AS contentUrlName
		FROM WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON
		TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID=P.IMAGEID
		LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
		<where>
			TPR.COLUMNID=#{columId}
			<if test="typeId !=null and typeId !='' and typeId != columId">and TPR.PRODUCTTYPEID!=#{typeId}</if>
			<if test="recommend !=null and recommend !='' ">and P.RECOMMEND=#{recommend}</if>
		</where>
	</select>
	<!-- 根据栏目id类型id查询产品地域 -->
	<select id="selectProductAreaByColumnIdlistPage" parameterType="page" resultMap="baseResultProduct">
		SELECT
			DISTINCT P.AREA 
		FROM
			WEB_PRODUCT P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID = P.ID
		LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID = P.IMAGEID 
		<where>
			TPR.COLUMNID=#{pd.columId}
			<if test="pd.typeId !=null and pd.typeId !='' and pd.typeId != pd.columId">and TPR.PRODUCTTYPEID=#{pd.typeId}</if>
			AND P.AREA is not null AND P.AREA != ''
		</where>
		<!-- 先根据编码排序,再转换 根据 地区的首字母排序-->
		ORDER BY P.NO+0,CONVERT( P.AREA USING gbk ) COLLATE gbk_chinese_ci ASC
	</select>
	
	<!--  -->
	<select id="selectBiaoTiById" resultMap="baseResultProduct">
		   SELECT P.ID,
		    PT.TXT,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_TXT PT ON P.ID=PT.CONTENT_ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='产品标题';
	</select>
	
	<select id="selectTeDianById" resultMap="baseResultProduct">
		    SELECT P.ID,
		    I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='特点描述';
	</select>
	
	<select id="selectLiangDianById" resultMap="baseResultProduct">
		    SELECT P.ID,
		    I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='产品亮点';
	</select>
	
	<select id="selectProductGuiGeById" resultMap="baseResultProduct">
		    SELECT P.ID,P.FILEDJSON,P.NAME,
		    I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='产品规格参数' ORDER BY P.CREATED_TIME;
	</select>
	
	<select id="selectProductJieJueById" resultMap="resultBrand">
		   SELECT B.ID AS BID,B.NAME AS BNAME,P.NAME,P.ID,P.PRODUCT_TEMPLATEID,P.PRODUCT_WBURL,
		   I2.IMGURL AS IMGURL,PT.TXT,WS.ID AS contentUrlName
			FROM WEB_BRAND B
			LEFT JOIN WEB_PRODUCT P ON B.ID=P.BRANDID
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN  WEB_BRAND B2 ON B2.ID=B.PID
			LEFT JOIN WEB_IMAGE I2 ON I2.IMAGE_ID=P.IMAGEID
			LEFT JOIN WEB_TXT PT ON P.ID=PT.CONTENT_ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B2.NAME='解决方案' ORDER BY B.CREATE_TIME,P.CREATED_TIME DESC;
	</select>
	<select id="selectProducPieJianById" resultMap="baseResultProduct">
			SELECT P.ID,P.PRODUCT_STATUS,
			I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			 WHERE PF.PRODUCTID=#{id}
			AND B.NAME='全套配件展示';
	</select>
	<select id="selectProductPeiTaoFuWuById" resultMap="baseResultProduct">
		    SELECT P.ID,P.FILEDJSON,P.NAME,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='配套服务';
	</select>
	<select id="selectProducLiuChengById" resultMap="baseResultProduct">
			SELECT P.ID,
			I2.TYPE AS TYPE_,I2.IMAGE_ID AS IMAGE_ID_,I2.TITLE AS TITLE_,I2.IMGURL AS IMGURL_,I2.BZ,I2.TOURL AS TOURL_,WS.ID AS contentUrlName
			FROM WEB_PRODUCT P 
			LEFT JOIN WEB_P_F PF ON P.ID=PF.FPRODUCTID
			LEFT JOIN WEB_BRAND B ON B.ID=P.BRANDID
			LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID=P.ID
			LEFT JOIN WEB_SKIPPATH WS ON P.ID=WS.CONTENTID
			WHERE PF.PRODUCTID=#{id}
			AND B.NAME='合作加盟申请流程';
	</select>
	<!-- 根据栏目ids查询分类ids -->
	<select id="selectIdsByColumnIds" resultType="String">
		SELECT PRODUCTID
		FROM WEB_TYPE_PRODUCT_RELATION
		WHERE COLUMNID IN
		<foreach collection="array" item="productid23" close=")" open="("
			separator=",">
			#{productid23}
		</foreach>
	</select>
	<!--以下为产品新框架增加内容 -->
	<!-- 根据栏目ID查询其内容  -->
	<select id="selectIdsByColumID" parameterType="String" resultType="String">
		SELECT DISTINCT PRODUCTID FROM WEB_TYPE_PRODUCT_RELATION WHERE 1=1
		<if test="columId !=null and columId !=''">
			AND COLUMNID=#{columId} 
		</if>
		<if test="typeId !=null and typeId !=''">
			AND PRODUCTTYPEID=#{typeId}
		</if>
		<if test="typeId =='-1'">
			AND (PRODUCTTYPEID IS NULL OR PRODUCTTYPEID ='')
		</if>
	</select>
	<!-- 根据内容ID数组，查询其关联信息  -->
	<select id="selectlistPageInfoByIdArry" parameterType="page" resultMap="baseResultProduct">
		SELECT
		P.ID,P.PRODUCT_TEMPLATEID,P.AREA,P.PRODUCT_WBURL,P.PRODUCT_SUMMARY,P.PRODUCT_KEYWORDS,
		P.PRODUCT_STATUS,P.NAME,P.NO,P.BRANDID,P.SORT,
		P.VALUE_TYPE,P.TOP,P.TOP_TIME,P.RECOMMEND,P.RECOMMEND_TIME,P.HOT,P.HOT_TIME,P.IMAGEID,P.UPDATE_TIME,
		CC.COLUM_NAME AS COLUMNAME_,CC.ID AS COLUMNID_,
		PT.ID AS TID_,PT.TYPE_NAME AS TYPE_NAME_
		FROM (/*start*/
			SELECT * FROM WEB_PRODUCT PR WHERE 1=1
			<if test="pd.keyword!=null and pd.keyword !=''">
				AND PR.NAME LIKE '%' #{pd.keyword} '%'
			</if>
			<if test="pd.idArry !=null and pd.idArry.length>0">
				AND PR.ID IN 
				<foreach collection="pd.idArry" close=")" item="productid24" open="(" separator=",">
					'${productid24}'
				</foreach>
			</if>
			ORDER BY PR.UPDATE_TIME DESC
		  /*end*/) P
		LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID=P.ID
		LEFT JOIN WEB_COLUMCONFIG CC ON CC.ID=TPR.COLUMNID
		LEFT JOIN WEB_PRODUCT_TYPE PT ON TPR.PRODUCTTYPEID=PT.ID
	</select>
	
	<!-- 修改状态与置顶 -->
	<update id="updataRecommendAndTopAndHotByIds" parameterType="cn.cebest.entity.system.product.Product">
		UPDATE WEB_PRODUCT
		<set>
			<if test="recommend !=null and recommend !=''">recommend=#{recommend},</if>
			<if test="recommend_time !=null">recommend_time=#{recommend_time},</if>
			<if test="hot !=null and hot !=''">hot=#{hot},</if>
			<if test="hot_time !=null">hot_time=#{hot_time},</if>
			<if test="top !=null and top !=''">top=#{top},</if>
			<if test="top_time !=null">top_time=#{top_time}</if>
		</set>
		WHERE ID IN
		<foreach collection="productRelevantIdList" item="productid25" close=")"
			open="(" separator=",">
			#{productid25}
		</foreach>
	</update>
	
	<!-- 查询类型对应的栏目数 -->
	<select id="selectCountByIds" resultType="HashMap">
		SELECT COUNT(*),PRDUCTTYPEID
		FROM WEB_PRODUCTTYPE_COLUMN
		WHERE PRDUCTTYPEID IN
		<foreach collection="array" item="productid26" close=")" open="(" separator=",">
			#{productid26}
		</foreach>
		GROUP BY PRDUCTTYPEID
	</select>
	
	<!-- 更新排序值 -->
	<update id="updateSort" parameterType="pd">
		UPDATE WEB_PRODUCT
		SET SORT= #{sort}
		WHERE ID =#{id}
	</update>
	
	<select id="selectProductByAllColumdlistPage" parameterType="page" resultMap="baseResultProduct">
		SELECT
	P.ID,
	TPR.COLUMNID AS columnId,
	P.PRODUCT_TEMPLATEID,
	P.PRODUCT_WBURL,
	P.PRODUCT_SUMMARY,
	P.PRODUCT_STATUS,
	P. NAME,
	P.SORT,
	P. NO,
	P.BRANDID,
	P.VALUE_TYPE,
	P.HOT,
	P.RECOMMEND,
	P.IMAGEID,
	P.RELEASE_TIME,
	P.AREA,
	I.TITLE,
	I.IMGURL,
	P.FILEDJSON,
	T.TXT,
	I2.TYPE AS TYPE_,
	I2.IMAGE_ID AS IMAGE_ID_,
	I2.TITLE AS TITLE_,
	I2.IMGURL AS IMGURL_,
	I2.BZ,
	I2.TOURL AS TOURL_,
	TPR.PRODUCTTYPEID AS typeId
FROM
	WEB_PRODUCT P
LEFT JOIN WEB_TYPE_PRODUCT_RELATION TPR ON TPR.PRODUCTID = P.ID
LEFT JOIN WEB_PRODUCTTYPE_COLUMN PC ON PC.COLUMNID = TPR.COLUMNID
LEFT JOIN WEB_IMAGE I ON I.IMAGE_ID = P.IMAGEID
LEFT JOIN WEB_IMAGE I2 ON I2.MASTER_ID = P.ID
LEFT JOIN WEB_TXT T ON P.ID = T.CONTENT_ID

		<where>
				1=1
			<if test="pd.columnId!=null and pd.columnId!=''">
			    AND TPR.COLUMNID=#{pd.columnId}
		    </if>
		    <if test="pd.typeA_id!=null and pd.typeA_id!=''">
			    AND TPR.PRODUCTTYPEID=#{pd.typeA_id}
		    </if>
		    <if test="pd.typeB_id!=null and pd.typeB_id!=''">
			    AND TPR.PRODUCTTYPEID=#{pd.typeB_id}
		    </if>
		     <if test="pd.typeC_id!=null and pd.typeC_id!=''">
			    AND TPR.PRODUCTTYPEID=#{pd.typeC_id}
		    </if>
		    
		</where>
		GROUP BY P.ID
	</select>
	

	<!-- 根据分类名称获取分类id -->
	<select id="findTypeIdByName" parameterType="string" resultMap="resultProduct">
		SELECT
			P.ID
		FROM
			WEB_PRODUCT_TYPE P
		WHERE
			P.TYPE_NAME = #{typeName}
	</select>
	
	<insert id="insertTypeRealtion" parameterType="pd">
		INSERT INTO
			WEB_TYPE_PRODUCT_RELATION
			(PRODUCTID,PRODUCTTYPEID,COLUMNID) 
			VALUES
			(#{productId},#{productTypeId},#{COLUM_ID})
	</insert>		

	<insert id="insertTypeProductUrlNameColumRelation" parameterType="cn.cebest.entity.system.product.Product">
		INSERT INTO WEB_SKIPPATH(CONTENTID,TYPEID,COLUMNID) VALUES
		<foreach collection="objKey_Value" item="item" open=""
			separator="," close="">
			(#{id},#{item.values},#{item.key})
		</foreach>
	</insert>
	
	<!-- 删除产品地址栏的url信息 -->
	<delete id="delProductUrlName">
		DELETE FROM WEB_SKIPPATH
		WHERE CONTENTID IN
		<foreach collection="array" close=")" item="id" open="("
			separator=",">
			#{id}
		</foreach>
	</delete>
	
	<!-- 根据资讯的id查询图片的路径 -->
	<select id="selectProductUrlName" parameterType="String" resultType="pd">
		SELECT PRODUCTID AS id,PRODUCTTYPEID AS typeid,COLUMNID AS columnid
		FROM WEB_TYPE_PRODUCT_RELATION 
		WHERE PRODUCTID = #{id}
	</select>
	
	<!-- 保存资讯url信息 -->
	<insert id="insertProductUrlNameColum" parameterType="pd">
		INSERT INTO WEB_SKIPPATH(CONTENTID,COLUMNID,TYPEID) VALUES(#{id},#{columnid},#{typeid})

	</insert>
	
	<select id="findProductByTypeOrColumnid" parameterType="pd" resultMap="baseResultProduct">
			SELECT 
				P.ID,
				WS.ID AS contentUrlName,
				WSC.SKIPPATH AS columUrlName
			FROM WEB_PRODUCT P 
				LEFT JOIN WEB_SKIPPATH WS ON WS.CONTENTID = P.ID
				LEFT JOIN WEB_SKIPPATH_COLUMN WSC ON WS.COLUMNID = WSC.COLUMNID
			<where>
				1=1
				<if test="SITEID !=null and SITEID !=''">and P.SITEID=#{SITEID}</if>
				<if test="contentId !=null and contentId !=''">and P.ID=#{contentId}</if>
				<if test="columnId !=null and columnId !=''">and WS.COLUMNID=#{columnId}</if>
				<if test="typeId !=null and typeId !=''">and WS.TYPEID=#{typeId}</if>
			</where>
	</select>
</mapper>
