<!DOCTYPE html>
<!--[if lt IE 7]><html class="ie ie6 lt8 lt9 lt10"><![endif]-->
<!--[if IE 7]><html class="ie ie7 lt8 lt9 lt10"><![endif]-->
<!--[if IE 8]><html class="ie ie8 lt9 lt10"><![endif]-->
<!--[if IE 9]><html class="ie ie9 lt10"><![endif]-->
<!--[if (gt IE 9) | !(IE)]><!-->
<html>
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta name="author" content="guanwang" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="renderer" content="webkit" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" name="viewport" />
<title>个人中心-我的消息</title>
<link rel="shortcut icon" href="../../staticRelease/img/favicon.ico" type="image/x-icon" />
<script>if (/*@cc_on!@*/false && document.documentMode === 10) document.documentElement.className += ' ie10';</script>
<script>if (/*@cc_on!@*/false && document.documentMode === 11) document.documentElement.className += ' ie11';</script>
<!-- 添加IE10+Class -->
<link rel="stylesheet" href="../../staticRelease/css/common.css">
<link type="text/css" rel="stylesheet" href="../../staticRelease/css/style.css" />
<link rel="stylesheet" type="text/css" href="../../staticRelease/css/personal-message.css"/>
<link rel="stylesheet" type="text/css" href="../../staticRelease/css/animate.css"/>
<link rel="stylesheet" type="text/css" href="../../staticRelease/css/paging.css"/>
<!--[if lt IE 9]>
<script src="../../staticRelease/js/html5.js"></script>
<script src="../../staticRelease/js/respond.src.js"></script>
<![endif]-->
<!--公用文件 END-->
<script type="text/javascript" src="../../staticRelease/js/jquery.js"></script>
<script src="../../staticRelease/js/image-scale.js" type="text/javascript" charset="utf-8"></script>
<script src="../../staticRelease/js/wow.min.js" type="text/javascript" charset="utf-8"></script>

	<!-- 站内消息(未读)模板 -->
	<template id="messageNoRead" style="display:none">
		<li class="on">
			<input type="checkbox" class="fl message" value="{messageId}" />
			<p class="mymessage_bt fl fnt_14">{content}</p>
			<p class="mymessage_time fr fnt_14">{time}</p>
			<div class="clear"></div>
		</li>
  	</template>
  	<!-- 站内消息(已读)模板 -->
	<template id="messageRead" style="display:none">
		<li>
			<input type="checkbox" class="fl message" value="{messageId}" />
			<p class="mymessage_bt fl fnt_14">{content}</p>
			<p class="mymessage_time fr fnt_14">{time}</p>
			<div class="clear"></div>
		</li>
  	</template>

</head>
<body>
<!--[if lt IE 9]>
  <p class="browserupgrade">您在使用&nbsp;<strong></strong>&nbsp;标准浏览本网站。请 <a href="http://browsehappy.com/" target="_blank">升级Internet Explorer浏览器</a> 来更好的体验本网站.</p>
<![endif]-->

<#include "../htmlFront/include/header.html">
<@colum_detail columId="9c83f37d371044ce9773fb3399be6f8c">
	<#if out_bean??>
		<div class="innerBanner prz">
			<img src="${imgPath}${out_bean.PIC_PATH!}" alt="">
			<div class="innerBox pra">
				<div class="wrap">
					<p class="chTil fnt_32 wow fadeInUp" data-wow-duration="1.5s">${out_bean.COLUM_NAME!}</p>
					<p class="line wow fadeInUp" data-wow-duration="1.5s"><span></span></p>
					<p class="enTil fnt_22 wow fadeInUp" data-wow-duration="1.5s">${out_bean.COLUM_SUBNAME!}</p>
				</div>
			</div>
		</div>
	</#if>
</@colum_detail>
	<div class="positionBox">
		<div class="wrap">
			<a href="${autoPath}" class="fnt_14">首页 > </a>
			<a href="${autoPath}/channel/center" class="fnt_14">个人中心 > </a>
			<a href="javascript:;" class="fnt_14 active">站内消息 </a>
		</div>
	</div>
<div class="page_link wrap pt_75">
	<a class="fl fnt_18 wow fadeInRight" href="/jump/personal-solution.html" data-wow-delay="0s" data-wow-duration="1s">我的方案</a>
	<a class="fl fnt_18 wow fadeInRight" href="/jump/personal-video.html" data-wow-delay="0.1s" data-wow-duration="1s">我的视频</a>
	<a class="fl fnt_18 wow fadeInRight" href="/jump/personal-partner.html" data-wow-delay="0.2s" data-wow-duration="1s">我的伙伴</a>
	<a class="fl fnt_18 on wow fadeInRight" href="javascript:;" data-wow-delay="0.3s" data-wow-duration="1s">站内消息</a>
	<div class="clear"></div>
</div>
<div class="my_message wrap pt_75">
	<div class="bt fnt_32 wow fadeIn" data-wow-delay="0.5s" data-wow-duration="1s">站内消息</div>
	<div class="pos_area3 pt_55 wrap pb_40">
		<div class="mymessage wow fadeInUp" data-wow-delay="0.8s" data-wow-duration="1s">
			<div class="mymessage_t">
				<p class="fl fnt_20">所有消息</p>
				<div class="fl fnt_14 read"><p>（共<span id="totalResult"></span>条，</p><a href="javascript:;">未读消息<i id="noRead"></i>条</a><span>|</span><a href="javascript:;" id="read">全部设为已读</a><span>|</span><a href="javascript:;" id="delete">删除</a><p>）</p></div>
				<div class="clear"></div>
			</div>
			<div class="mymessage_c">
				<p class="quanxuan fl">
					<input type="checkbox" id="checkbox-1-1"/><label for="checkbox-1-1"><span>全选</span></label>
				</p>
				<p class="p1 fnt_14 fl">主题</p>
				<!--<p class="p3 fnt_14 fr">操作</p>-->
				<p class="p2 fnt_14 fr">发送时间</p>
				<div class="clear"></div>
			</div>
			<div class="mymessage_list pb_40">
				<ul id="message">
					
				</ul>
			</div>
			<div class="mymessage_c">
				<p class="quanxuan fl">
					<input type="checkbox" id="checkbox-1-2"/><label for="checkbox-1-2"><span>全选</span></label>
				</p>
				<div class="clear"></div>
			</div>
		</div>
	</div>
	<div id="page" class="page_div"></div>
</div>
<div class="mask"></div>
<div class="alert_box">
	<div class="content">
		
	</div>
	<div class="btn clearfix">
		<span class="closed_btn">关闭</span>
	</div>
</div>
<!--footer begin-->
<#include "../htmlFront/include/footer.html">
<!--footer end-->
</body>
<script type="text/javascript" src="../../staticRelease/js/base.js"></script>
<script type="text/javascript" src="../../staticRelease/js/index.js"></script>
<script type="text/javascript" src="../../staticRelease/js/paging.js"></script>
<script type="text/javascript">
var userId = "${(_const_cas_assertion_.principal.attributes.id)!}"
	//消息全选与反选
	$('#checkbox-1-1').click(function(){
		var flag = $(this).is(':checked');
		if (flag) {
			$('.mymessage_list ul li input').prop("checked",true);
			$("#checkbox-1-2").prop("checked",true);
		} else{
			$('.mymessage_list ul li input').prop("checked",false);
			$("#checkbox-1-2").prop("checked",false);
		}
	})
	$('#checkbox-1-2').click(function(){
		var flag = $(this).is(':checked');
		if (flag) {
			$('.mymessage_list ul li input').prop("checked",true);
			$("#checkbox-1-1").prop("checked",true);
		} else{
			$('.mymessage_list ul li input').prop("checked",false);
			$("#checkbox-1-1").prop("checked",false);
		}
	})
	$('.mymessage_list ul li input').click(function(){
		var flag = $(this).is(':checked');
		if (flag) {
			$("#checkbox-1-1").prop("checked",false);
			$("#checkbox-1-2").prop("checked",false);
		} else{
			$("#checkbox-1-1").prop("checked",false);
			$("#checkbox-1-2").prop("checked",false);
		}
	})
	
	function message(num){
		$.ajax({
			type : "POST",
			url : "/stationMessage/messageList",
			data:{
				"userId" : userId,
				"currentPage" : num,
				"showCount" : 6
			},
			dataType : "json",
			success : function(data) {
				if(data.status == 999){
					window.location.href = data.location;
				}
				$("#message").empty();
				var d = data.data;
				$(d.newData.data).each(function(){
					if(this.isRead == '0'){
						var messageT = $("#messageNoRead").html();
						messageT = messageT.replace("{messageId}",this.id);
						messageT = messageT.replace("{content}",this.content);
						messageT = messageT.replace("{time}",this.createTime);
						$("#message").append(messageT);
					}else{
						var messageT = $("#messageRead").html();
						messageT = messageT.replace("{messageId}",this.id);
						messageT = messageT.replace("{content}",this.content);
						messageT = messageT.replace("{time}",this.createTime);
						$("#message").append(messageT);
					}
				});
				$("#totalResult").html(d.page.totalResult);
				$("#noRead").html(d.newData.noRead);
				
				$('img.scale').imageScale();
				new WOW().init();
				
				//分页
				$("#page").paging({
					pageNo: num,
					totalPage: d.page.totalPage,
					totalSize: d.page.totalResult,
					callback: function(num) {
						message(num)
					}
				})
			}// end success
		});//ajax end
	};
	$(function(){
		message(1);
		
		$("#read").click(function(){
			var num = $("#noRead").html();
			if(num < 1){
				return;
			}
			
			$.ajax({
				type : "POST",
				url : "/stationMessage/readAll",
				data:{
					"userId" : userId
				},
				dataType : "json",
				success : function(data) {
					message();
				}// end success
			});//ajax end
			
		});
		
		$("#delete").click(function(){
			var ids = [];
			$("input[class='fl message']:checked").each(function(i){//把所有被选中的复选框的值存入数组
	            ids[i] =$(this).val();
	        }); 
			
			if(ids.length < 1){
				return;
			}
			$.ajax({
				type : "POST",
				url : "/stationMessage/deleteMessage",
				data:{
					"ids" : ids
				},
				traditional: true,
				success : function(data) {
					message();
				}// end success
			});//ajax end
			
		});
	});
</script>
<script type="text/javascript">
$(function(){
	//关闭弹窗
	$(".alert_box .closed_btn,.mask").click(function(){
		//清空弹框里面的内容
		$(".mask").css({
			'display':'none'
		})
		$(".alert_box .content").text('');
		$(".alert_box").hide();
	})
	
	$(document).on('click','.mymessage_bt',function(){
		$(this).parent().removeClass("on");
		var noRead = $("#noRead").text();
		
		var path = $(this).find("a").data("name");
		
		
		
		$("#noRead").text(noRead-1);
		$(".mask").css({
			'display':'block'
		})
		var content = $(this).html();
		content = content.replace("javascript:;",path);
		$(".alert_box .content").html(content);
		$(".alert_box").show();
		var id = $(this).data("id");
		if(id != null && id != ''){
			$.ajax({
				type : "POST",
				url : "/stationMessage/readMsg",
				data:{
					"id" : id
				},
				dataType : "json",
				success : function(data) {
					
				}// end success
			});//ajax end
		}
		
	});
});
</script>

</html>          