<!DOCTYPE html>
<!--[if lt IE 7]><html class="ie ie6 lt8 lt9 lt10"><![endif]-->
<!--[if IE 7]><html class="ie ie7 lt8 lt9 lt10"><![endif]-->
<!--[if IE 8]><html class="ie ie8 lt9 lt10"><![endif]-->
<!--[if IE 9]><html class="ie ie9 lt10"><![endif]-->
<!--[if (gt IE 9) | !(IE)]><!-->
<html>
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta name="author" content="guanwang" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="renderer" content="webkit" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" name="viewport" />
<title>个人中心</title>
<link rel="shortcut icon" href="../../staticRelease/img/favicon.ico" type="image/x-icon" />
<script>if (/*@cc_on!@*/false && document.documentMode === 10) document.documentElement.className += ' ie10';</script>
<script>if (/*@cc_on!@*/false && document.documentMode === 11) document.documentElement.className += ' ie11';</script>
<!-- 添加IE10+Class -->
<link rel="stylesheet" href="../../staticRelease/css/common.css">
<link type="text/css" rel="stylesheet" href="../../staticRelease/css/style.css" />
<link rel="stylesheet" type="text/css" href="../../staticRelease/css/personal.css"/>
<link rel="stylesheet" type="text/css" href="../../staticRelease/css/animate.css"/>
<!--[if lt IE 9]>
<script src="../../staticRelease/js/html5.js"></script>
<script src="../../staticRelease/js/respond.src.js"></script>
<![endif]-->
<!--公用文件 END-->
<script type="text/javascript" src="../../staticRelease/js/jquery.js"></script>
<script src="../../staticRelease/js/image-scale.js" type="text/javascript" charset="utf-8"></script>
<script src="../../staticRelease/js/wow.min.js" type="text/javascript" charset="utf-8"></script>

	<!-- 我的伙伴-->
	<template id="partnerT" style="display:none">
		<li class="fl">
			<a href="${basePath}/skippath/{contentUrl}">
				<img src="${imgPath}/{image}"/>
			</a>
		</li>
  	</template>
	<!-- 我的解决方案模板 -->
	<template id="solutionT" style="display:none">
		<li class="solution_inx fl pb_55 wow fadeInUp" data-wow-delay="0.5s" data-wow-duration="1s">
			<a href="${basePath}/skippath/{contentUrl}">
				<div class="img_w">
					<img class="scale" src="${imgPath}/{image}"/>
				</div>
				<div class="solution_bt">
					<p class="p1 fnt_20">{title}</p>
					<p class="p2 fnt_16 mt_15">{content}</p>
				</div>
				<a class="text-decoration:none" href="javascript:;"><img class="mt_20 next" src="${basePath}/staticRelease/img/next.png"/></a>
			</a>
		</li>
  	</template>
  	<!-- 站内消息(未读)模板 -->
	<template id="messageNoRead" style="display:none">
		<li class="on">
			<input type="checkbox" class="fl message" value="{messageId}" />
			<p class="mymessage_bt fl fnt_14" data-id="{id}">{content}</p>
			<!--<a href="javascript:;" class="mymessage_caozuo fr">删除</a>-->
			<p class="mymessage_time fr fnt_14">{time}</p>
			<div class="clear"></div>
		</li>
  	</template>
  	<!-- 站内消息(已读)模板 -->
	<template id="messageRead" style="display:none">
		<li>
			<input type="checkbox" class="fl message" value="{messageId}" />
			<p class="mymessage_bt fl fnt_14" data-id="">{content}</p>
			<!--<a href="javascript:;" class="mymessage_caozuo fr">删除</a>-->
			<p class="mymessage_time fr fnt_14">{time}</p>
			<div class="clear"></div>
		</li>
  	</template>
  	
  	<!-- 我的视频模板 -->
	<template id="videoT" style="display:none">
		<a href="${basePath}/skippath/{contentUrl}" class="video_inx fl">
			<div class="img_w">
				<img class="scale" src="${imgPath}/{image}"/>
			</div>
			<div class="video_b pt_40 pb_30">
				<p class="fnt_20 p1">{title}</p>
				<p class="mt_30 p2">查看详情 ></p>
			</div>
		</a>
  	</template>

	<template id="clear" style="display:none">
		<div class="clear"></div>
  	</template>
</head>
<body>
<!--[if lt IE 9]>
  <p class="browserupgrade">您在使用&nbsp;<strong></strong>&nbsp;标准浏览本网站。请 <a href="http://browsehappy.com/" target="_blank">升级Internet Explorer浏览器</a> 来更好的体验本网站.</p>
<![endif]-->

<#include "../htmlFront/include/header.html">
<#include "../htmlFront/include/banner.html"/>
<div class="positionBox">
	<div class="wrap">
		<a href="${basePath}" class="fnt_14">首页 > </a>
		<a href="javascript:;" class="fnt_14 active">个人中心 </a>
	</div>
</div>
<div class="pos_area1 wrap pt_75 pb_60">
	<div class="account fl wow fadeInLeft" data-wow-delay="0.5s" data-wow-duration="1s">
		<div class="touxiang fl">
			<img class="scale" id="photoUrlId" src=""/>
		</div>
		<div class="xinxi fl">
			<p class="name fnt_24">${(_const_cas_assertion_.principal.attributes.name)!} ${(_const_cas_assertion_.principal.attributes.surname)!}</p>
			<p class="up_time fnt_16">上次登录：${_const_cas_assertion_.principal.attributes.loginTime!}</p>
			<div class="edit_icon clearfix">
				<a class="fnt_16 bianji mt_30" style="display:inline" id="edit">
					<img src="${basePath}/staticRelease/img/uploadfiles/bianji.png"/>
					编辑资料
				</a>
				<a class="fnt_16 bianji mt_30" id="editPwd">
					<img src="${basePath}/staticRelease/img/uploadfiles/bianji.png"/>
					修改密码
				</a>
			</div>
		</div>
		<div class="clear"></div>
	</div>
	<div class="MyPartner fr wow fadeInRight" data-wow-delay="0.5s" data-wow-duration="1s">
		<div class="partner_t">
			<p class="bt fnt_24 fl">我的伙伴</p>
			<a class="fr" href="/jump/personal-partner.html">查看更多></a>
			<div class="clear"></div>
		</div>
		<div class="partner_b mt_45">
			<ul id="partner">
			
			</ul>
		</div>
	</div>
	<div class="clear"></div>
</div>
<div class="pos_area2 pt_85 wrap pb_40">
	<p class="bigbt fnt_30 wow fadeIn" data-wow-delay="0.5s" data-wow-duration="1s">我的解决方案</p>
	<div class="mysolution pt_75 pb_30">
		<ul id="solution">
			
			
		</ul>
	</div>
	<div class="learn_more wow fadeInUp" data-wow-delay="0.5s" data-wow-duration="1s">
		<a class="fnt_16" href="/jump/personal-solution.html">查看更多</a>
	</div>
</div>

<div class="pos_area3 pt_55 wrap pb_40">
	<p class="bigbt fnt_30 wow fadeIn" data-wow-delay="0.5s" data-wow-duration="1s">站内消息</p>
	<div class="mymessage mt_75 pb_40 wow fadeIn" data-wow-delay="0.5s" data-wow-duration="1s">
		<div class="mymessage_t">
			<p class="fl fnt_20">所有消息</p>
			<div class="fl fnt_14 read"><p>（共<span id="totalResult"></span>条，</p><a href="javascript:;">未读消息<i id="noRead"></i>条</a><span>|</span><a href="javascript:;" id="read">全部设为已读</a><span>|</span><a href="javascript:;" id="delete">删除</a><p>）</p></div>
			<div class="clear"></div>
		</div>
		<div class="mymessage_c">
			<p class="quanxuan fl">
				<input type="checkbox" id="checkbox-1-1" class="regular-checkbox" /><label for="checkbox-1-1"><span>全选</span></label>
			</p>
			<p class="p1 fnt_14 fl">主题</p>
			<!--<p class="p3 fnt_14 fr">操作</p>-->
			<p class="p2 fnt_14 fr">发送时间</p>
			<div class="clear"></div>
		</div>
		<div class="mymessage_list pb_55">
			<ul id="message">
			
			</ul>
		</div>
		<div class="learn_more wow fadeInUp" data-wow-delay="0.5s" data-wow-duration="1s">
			<a class="fnt_16" href="/jump/personal-message.html">查看更多</a>
		</div>
	</div>
</div>
<div class="pos_area4 pt_55 wrap pb_85">
	<p class="bigbt fnt_30 wow fadeInUp" data-wow-duration="1s">我的视频</p>
	<div class="myvideo pt_75 pb_75 wow fadeInUp" data-wow-delay="0.5s" data-wow-duration="1s" id="video">
		
	</div>
	<div class="learn_more wow fadeInUp" data-wow-delay="0.5s" data-wow-duration="1s">
		<a class="fnt_16" href="/jump/personal-video.html">查看更多</a>
	</div>
</div>
<div class="mask"></div>
<div class="alert_box">
	<div class="content">
		
	</div>
	<div class="btn clearfix">
		<span class="closed_btn">关闭</span>
	</div>
</div>
<!--footer begin-->
<#include "../htmlFront/include/footer.html">
<!--footer end-->
<!--弹框-->

<script type="text/javascript" src="../../staticRelease/js/base.js"></script>
<script type="text/javascript" src="../../staticRelease/js/index.js"></script>
<script type="text/javascript" src="../../staticRelease/js/baseData.js"></script>
<script type="text/javascript">
	
</script>
<script type="text/javascript">
var userId = "${(_const_cas_assertion_.principal.attributes.id)!}";
	//消息全选与反选
	$('#checkbox-1-1').click(function(){
		var flag = $(this).is(':checked');
		if (flag) {
			$('.mymessage_list ul li input').prop("checked",true);
		} else{
			$('.mymessage_list ul li input').prop("checked",false);
		}
		
	})
	$('.mymessage_list ul li input').click(function(){
		var flag = $(this).is(':checked');
		if (flag) {
			$("#checkbox-1-1").prop("checked",false);
		} else{
			$("#checkbox-1-1").prop("checked",false);
		}
	})
	
	// 站内消息
	function message(){
		$.ajax({
			type : "POST",
			url : "/stationMessage/messageList",
			data:{
				"userId" : userId,
				"currentPage" : 1,
				"showCount" : 4
			},
			dataType : "json",
			success : function(data) {
				$("#message").empty();
				$(data.data.newData.data).each(function(){
					if(data.status == 999){
						window.location.href = data.location;
					}
					if(this.isRead == '0'){
						var messageT = $("#messageNoRead").html();
						messageT = messageT.replace("{messageId}",this.id);
						messageT = messageT.replace("{id}",this.id);
						messageT = messageT.replace("{content}",this.content);
						messageT = messageT.replace("{time}",this.createTime);
						$("#message").append(messageT);
					}else{
						var messageT = $("#messageRead").html();
						messageT = messageT.replace("{content}",this.content);
						messageT = messageT.replace("{time}",this.createTime);
						$("#message").append(messageT);
					}
				});
				$("#totalResult").html(data.data.page.totalResult);
				$("#noRead").html(data.data.newData.noRead);
				$("#message").append($("#clear").html());
			}// end success
		});//ajax end
	};
	
	$(function(){
		var source = '${_const_cas_assertion_.principal.attributes.source!}';
		if(source == '1'){
			$("#edit").attr("href",baseData.dress+"/jump/editor.html");
		}else{
			$("#edit").attr("href","${basePath}/jump/editor.html");
		}
		$("#editPwd").attr("href","${basePath}/jump/ensure_password.html");
		var photoUrl = '${_const_cas_assertion_.principal.attributes.photoUrl!}';
		if(photoUrl != null && photoUrl != ''){
			$("#photoUrlId").attr("src",baseData.member_base_url+"/upload/"+photoUrl);
		}else{
			$("#photoUrlId").attr("src","${basePath}/staticRelease/img/z_user.png");
		}
		
		
		// 我的伙伴
		$.ajax({
			type : "POST",
			url : "/collection/getCollections",
			data:{
				"userId" : userId,
				"resourceType" : 2,
				"currentPage" : 1,
				"showCount" : 4
			},
			dataType : "json",
			success : function(data) {
				if(data.status == 999){
					window.location.href = data.location;
				}
				$("#partner").empty();
				$(data.data.data).each(function(){
					var partnerT = $("#partnerT").html();
					partnerT = partnerT.replace("{contentUrl}",this.columUrlName+"/"+this.columUrlName+"_"+this.contentUrlName);
					partnerT = partnerT.replace("{image}",this.SURFACE_IMAGEURL);
					$("#partner").append(partnerT);
				});
				$("#partner").append($("#clear").html());
			}// end success
		});//ajax end
		
		// 站内消息
		message();
		
		// 我的解决方案
		$.ajax({
			type : "POST",
			url : "/collection/getCollections",
			data:{
				"userId" : userId,
				"resourceType" : 1,
				"currentPage" : 1,
				"showCount" : 6
			},
			dataType : "json",
			success : function(data) {
				if(data.status == 999){
					window.location.href = data.location;
				}
				$("#solution").empty();
				$(data.data.data).each(function(){
					var solutionT = $("#solutionT").html();
					solutionT = solutionT.replace("{contentUrl}",this.columUrlName+"/"+this.columUrlName+"_"+this.contentUrlName);
					solutionT = solutionT.replace("{image}",this.SURFACE_IMAGEURL);
					solutionT = solutionT.replace("{title}",this.CONTENT_TITLE);
					solutionT = solutionT.replace("{content}",this.CONTENT_SUMMARY);
					$("#solution").append(solutionT);
				});
				$("#solution").append($("#clear").html());
			}// end success
		});//ajax end
		
		
		
		
		//我的视频
		$.ajax({
			type : "POST",
			url : "/collection/getCollections",
			data:{
				"userId" : userId,
				"resourceType" : 3,
				"currentPage" : 1,
				"showCount" : 4
			},
			dataType : "json",
			success : function(data) {
				if(data.status == 999){
					window.location.href = data.location;
				}
				$("#video").empty();
				if(data.data != null){
					$(data.data.data).each(function(){
						var videoT = $("#videoT").html();
						videoT = videoT.replace("{contentUrl}",this.columUrlName+"/"+this.columUrlName+"_"+this.contentUrlName);
						videoT = videoT.replace("{image}",this.SURFACE_IMAGEURL);
						videoT = videoT.replace("{title}",this.CONTENT_TITLE);
						$("#video").append(videoT);
					});
				}
				
				$("#video").append($("#clear").html());
			}// end success
		});//ajax end
		
		
		
		$("#read").click(function(){
			var num = $("#noRead").html();
			if(num < 1){
				return;
			}
			
			$.ajax({
				type : "POST",
				url : "/stationMessage/readAll",
				data:{
					"userId" : userId
				},
				dataType : "json",
				success : function(data) {
					message();
				}// end success
			});//ajax end
			
		});
		
		$("#delete").click(function(){
			var ids = [];
			$("input[class='fl message']:checked").each(function(i){//把所有被选中的复选框的值存入数组
	            ids[i] =$(this).val();
	        }); 
			
			if(ids.length < 1){
				return;
			}
			$.ajax({
				type : "POST",
				url : "/stationMessage/deleteMessage",
				data:{
					"ids" : ids
				},
				traditional: true,
				success : function(data) {
					message();
				}// end success
			});//ajax end
			
		});
		
		
		
		$('img.scale').imageScale();
		new WOW().init();
		
		
	});
</script>
<script type="text/javascript">
$(function(){
	//关闭弹窗
	$(".alert_box .closed_btn,.mask").click(function(){
		//清空弹框里面的内容
		$(".mask").css({
			'display':'none'
		})
		$(".alert_box .content").text('');
		$(".alert_box").hide();
	})
	/* $(document).on('click','.newPath',function(){
		var path = $(this).data("name");
		var id = $(this).parent().data("id");
		if(id != null && id != ''){
			$.ajax({
				type : "POST",
				url : "/stationMessage/readMsg",
				data:{
					"id" : id
				},
				dataType : "json",
				success : function(data) {
					window.location.href=path;
				}// end success
			});//ajax end
		}
	}); */
	$(document).on('click','.mymessage_bt',function(){
		$(this).parent().removeClass("on");
		var noRead = $("#noRead").text();
		
		var path = $(this).find("a").data("name");
		
		
		
		$("#noRead").text(noRead-1);
		$(".mask").css({
			'display':'block'
		})
		var content = $(this).html();
		content = content.replace("javascript:;",path);
		$(".alert_box .content").html(content);
		$(".alert_box").show();
		var id = $(this).data("id");
		if(id != null && id != ''){
			$.ajax({
				type : "POST",
				url : "/stationMessage/readMsg",
				data:{
					"id" : id
				},
				dataType : "json",
				success : function(data) {
					
				}// end success
			});//ajax end
		}
		
	});
});
</script>
</body>
</html>          